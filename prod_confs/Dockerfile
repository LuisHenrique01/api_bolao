FROM python:3.10

ENV PYTHONUNBUFFERED 1

WORKDIR /code
RUN mkdir static

COPY requirements.txt /code/
RUN pip install --no-cache-dir -r requirements.txt

RUN python manage.py collectstatic --noinput

COPY . /code/

ENV DB_USER=${DB_USER}
ENV DB_PASSWORD=${DB_PASSWORD}
ENV DB_NAME=${DB_NAME}
ENV DB_HOST=${DB_HOST}
ENV DB_PORT=${DB_PORT}
ENV DJANGO_SECRET_KEY=${DJANGO_SECRET_KEY}
ENV CELERY_BROKER=${CELERY_BROKER}
ENV DEBUG=${DEBUG}
ENV KEY_FOOTBALL_API_IO=${KEY_FOOTBALL_API_IO}
ENV KEY_FOOTBALL_API_RAPID=${KEY_FOOTBALL_API_RAPID}
ENV ID_CARTEIRA_BANCA=${ID_CARTEIRA_BANCA}
ENV EMAIL=${EMAIL}
ENV SENHA_EMAIL=${SENHA_EMAIL}
ENV MIN_SAQUE=${MIN_SAQUE}
ENV MIN_DEPOSITO=${MIN_DEPOSITO}
ENV DAYS_GET_JOGOS=${DAYS_GET_JOGOS}
ENV TAXA_BANCA=${TAXA_BANCA}
ENV MAX_TAXA_CRIADOR=${MAX_TAXA_CRIADOR}
ENV MIN_TAXA_CRIADOR=${MIN_TAXA_CRIADOR}
ENV MAX_PALPITE=${MAX_PALPITE}
ENV MIN_PALPITE=${MIN_PALPITE}

CMD ["sh", "-c", "python manage.py migrate && \
    gunicorn api_bolao.wsgi:application --bind 0.0.0.0:8000 && \
    celery -A api_bolao worker --loglevel=INFO"]